<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PushBox</title>
    <meta charset="utf-8" user-scalable="no" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A Game for CS4241 by Mark Renzi, Jordan Wecler, and Cather Zhang.">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <link rel="manifest" crossorigin="use-credentials" href="/manifest.json"/>
  </head>
  <body class="hero is-warning is-fullheight py-2">
    <main class="container is-fluid has-background-warning-light">
      <div class="container has-background-warning box">
        <div id="root"></div>
      </div>
    </main>
  </body>
  <script>
    const add = function (e) {
      // prevent default form action from being carried out
      e.preventDefault();

      const input = document.querySelector("#yourname"),
        //clicks = document.querySelector("#clicks"),
        CPS = document.querySelector("#result");
      let json = {
          Name: input.value,
          Clicks: score,
          CPS: (score / duration).toFixed(1),
          Rating: 0,
          User: 0,
          Delete: 0,
        },
        body = JSON.stringify(json);

      if (
        score !== 0 &&
        score === parseFloat(CPS.textContent) * 10
      ) {
        fetch("/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(json),
        }).then(function (response) {
          // do something with the reponse
          updateTable();
        });
      }

      return false;
    };
    
    window.onload = function () {
      // const button = document.getElementById("formButton");
      // const clickArea = document.getElementById("clickarea");
      // clickArea.style.backgroundColor = "hsl(171, 100%, 29%)";
      // button.onclick = add;
      // updateTable();
      // const UID = (async () => {
      // const data = await getUID();
      // return data
      //})()
    };
    
    // function getUID() {
    //   fetch("/getuid", {
    //     method: "GET",
    //   })
    //     .then((response) => response.json())
    //     .then(function (json) {
    //       return json.UID;
    //     });
    // }

    function updateTable() {
      let lastSpot = document.documentElement.scrollTop || document.body.scrollTop;
      let table = document.getElementById("scoreList");
      table.innerHTML =
        "<thead><tr><th>Name</th><th>Clicks</th><th>Rating</th><th>Delete?</th></tr></thead>";
      fetch("/getScores", {
        method: "GET",
      })
        .then((response) => response.json())
        .then(function (json) {
          for (let response of json) {
            let i = 0;
            for (i = 1; i < table.rows.length; i++) {
              if (
                parseInt(response.Clicks, 10) >
                parseInt(table.rows.item(i).cells.item(1).innerHTML, 10)
              ) {
                //this ensures the leaderboard is sorted
                break;
              }
            }
            let row = table.insertRow(i);
            let Name = row.insertCell(0);
            let Clicks = row.insertCell(1);
            let Rating = row.insertCell(2);
            let End = row.insertCell(3);

            row.cells[0].innerHTML = response.Name;
            row.cells[1].innerHTML = response.Clicks;
            row.cells[2].innerHTML = response.Rating;

            if (parseInt(response.Delete) == 1) {
              var btn = document.createElement("button");
              btn.type = "button";
              btn.innerHTML = "Delete this score";
              btn.className = "delete is-medium";
              btn.onclick = (function (entry) {
                return function () {
                  chooseUser(response.Name);
                };
              })(response.Name);
              End.appendChild(btn);
            }
          }
        window.scrollTo(0,lastSpot);
        });
    }

    function chooseUser(usr) {
      fetch("/remove", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ Name: usr }),
      }).then(function (response) {
        // do something with the reponse
        updateTable();
      });
    }
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/javascript" src="../model/Puzzle.js"></script>
  <script type="text/javascript" src="../Layout.js"></script>
  <script type="text/javascript" src="../controller/Controller.js"></script>
  <script type="text/javascript" src="../boundary/Boundary.js"></script>
  <script type="text/javascript" src="../model/Model.js"></script>
  <script type="text/babel" src="../App.jsx"></script>
  <script type="text/babel" src="../index.jsx"></script>
  
  <!--<script src="../public/scripts.js"></script>-->
</html>
